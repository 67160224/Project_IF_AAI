{"files":[{"id":"e360abdc-1281-4151-8165-77d246acf688","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Bangkok\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"23516831-dfa4-4acb-8dc2-a941d1912775","name":"Code","type":"server_js","source":"// *** 1. การตั้งค่า ***\n// โทเค็นบอทของคุณ\nconst BOT_TOKEN \u003d \"8351327796:AAH4HErPl67KCM-BUqRcoEK-N2_lpwfzbFs\"; \nconst TELEGRAM_URL \u003d \"https://api.telegram.org/bot\" + BOT_TOKEN;\n\n// ชื่อบัญชีแจ้งเตือนของคุณ (ใช้แทน {AccountName})\nconst ACCOUNT_NAME \u003d \"Smart Box\"; \n\n// ตัวอย่าง Chat ID สำหรับส่งข้อความแจ้งเตือนถึงผู้ดูแล/แอดมิน (ถ้ามี)\nconst ADMIN_CHAT_ID \u003d \"8498711569\"; \n\n\n// *** 2. ฟังก์ชัน Webhook หลัก ***\nfunction doPost(e) {\n  var contents \u003d JSON.parse(e.postData.contents);\n  \n  if (contents.message) {\n    var message \u003d contents.message;\n    var chatId \u003d message.chat.id;\n    var text \u003d message.text;\n    \n    // ดึงข้อมูลผู้ใช้ที่กำลังส่งข้อความ\n    var user \u003d message.from;\n    // ดึงชื่อแรก (ถ้าไม่มี ให้ใช้ \u0027เพื่อน\u0027 แทน)\n    var firstName \u003d user.first_name || \"เพื่อน\"; \n    \n    // ตรวจสอบว่าผู้ใช้ส่งคำสั่ง /start หรือไม่\n    if (text \u003d\u003d\u003d \"/start\") {\n      sendWelcomeMessage(chatId, firstName);\n    } \n  }\n}\n\n\n// *** 3. ฟังก์ชันการส่งข้อความ ***\nfunction sendMessage(chatId, text) {\n  var payload \u003d {\n    \u0027method\u0027: \u0027sendMessage\u0027,\n    \u0027chat_id\u0027: String(chatId),\n    \u0027text\u0027: text\n  };\n  \n  var options \u003d {\n    \u0027method\u0027: \u0027post\u0027,\n    \u0027contentType\u0027: \u0027application/json\u0027,\n    \u0027payload\u0027: JSON.stringify(payload)\n  };\n  \n  UrlFetchApp.fetch(TELEGRAM_URL + \u0027/\u0027, options);\n}\n\n\n/// *** 4. ฟังก์ชันข้อความต้อนรับ (ปรับปรุงใหม่) ***\nfunction sendWelcomeMessage(chatId, nickname) {\n  var welcomeMessage \u003d \n    `เรียน คุณ *${nickname}*\\n\\n` + \n    `ขอต้อนรับเข้าสู่ระบบแจ้งเตือนของ *${ACCOUNT_NAME}* อย่างเป็นทางการค่ะ\\n\\n` + \n    `*${ACCOUNT_NAME}* เป็นบอทแจ้งเตือนอัตโนมัติที่ให้บริการดังนี้:\\n` +\n    `1. แจ้งเตือนสถานะเมื่อพัสดุของท่านมาถึง (*จัดส่งสำเร็จ*)\\n` +\n    `2. แจ้งเตือนเมื่อพัสดุถูกจัดส่งเรียบร้อยแล้ว\\n` +\n    `3. มีบริการส่งภาพถ่ายผู้ส่งพัสดุประกอบการแจ้งเตือนทุกครั้ง\\n\\n` +\n    `บัญชีนี้จะดำเนินการแจ้งเตือนและติดตามพัสดุสำหรับ คุณ *${nickname}* โดยเฉพาะ`;\n\n  // ส่วนการส่งข้อความอื่น ๆ คงเดิม\n  var payload \u003d {\n    \u0027method\u0027: \u0027sendMessage\u0027,\n    \u0027chat_id\u0027: String(chatId),\n    \u0027text\u0027: welcomeMessage,\n    \u0027parse_mode\u0027: \u0027Markdown\u0027 \n  };\n  \n  var options \u003d {\n    \u0027method\u0027: \u0027post\u0027,\n    \u0027contentType\u0027: \u0027application/json\u0027,\n    \u0027payload\u0027: JSON.stringify(payload)\n  };\n  \n  UrlFetchApp.fetch(TELEGRAM_URL + \u0027/\u0027, options);\n}\n\n// *** 5. ฟังก์ชันสำหรับตั้งค่า Webhook (สำคัญมาก! ต้องรันครั้งเดียว) ***\nconst WEB_APP_URL \u003d \"https://script.google.com/macros/s/AKfycbyT9ZToZvBlpWoCOyCasR21U3z4qxS--EmLxgUOjAU3GwybV_b2CG3awsV7M662C4VHBQ/exec\"; \n\nfunction setWebhook() {\n  var url \u003d TELEGRAM_URL + \"/setWebhook?url\u003d\" + WEB_APP_URL;\n  var response \u003d UrlFetchApp.fetch(url);\n  Logger.log(\"Webhook Response: \" + response.getContentText());\n}"}]}